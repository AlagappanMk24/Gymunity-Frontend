<!-- Mobile/Tablet Backdrop -->
@if (isSidebarOpen()) {
  <div
    class="fixed inset-0 bg-black/40 backdrop-blur-sm z-30 lg:hidden"
    (click)="closeSidebar()"
  ></div>
}

<aside
  [class]="
    'fixed left-0 top-14 sm:top-16 md:top-20 bottom-0 bg-white border-r border-gray-200 overflow-y-auto flex flex-col shadow-lg transition-all duration-300 ' +
    (isCollapsed() ? 'w-20' : 'w-72')
  "
  [ngClass]="{
    'hidden lg:flex': true,
    'flex z-40': isSidebarOpen(),
    hidden: !isSidebarOpen(),
  }"
>
  <!-- Logo/Brand Section -->
  <div
    class="p-4 border-b border-gray-100 bg-gradient-to-br from-sky-50 to-indigo-50"
    [class.justify-center]="isCollapsed()"
    [class.p-3]="isCollapsed()"
  >
    <div
      class="flex items-center"
      [ngClass]="isCollapsed() ? 'justify-center' : 'gap-3'"
    >
      <div
        class="w-12 h-12 bg-gradient-to-br from-sky-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-xl transform hover:scale-110 transition-transform duration-200 flex-shrink-0"
      >
        <svg
          class="w-7 h-7 text-white"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2.5"
            d="M13 10V3L4 14h7v7l9-11h-7z"
          ></path>
        </svg>
      </div>
      @if (!isCollapsed()) {
        <div>
          <h2
            class="text-gray-900 font-bold text-xl bg-gradient-to-r from-sky-600 to-indigo-600 bg-clip-text text-transparent"
          >
            FitTracker
          </h2>
          <p class="text-gray-500 text-sm font-medium">Your Fitness Hub</p>
        </div>
      }
    </div>
  </div>

  <!-- Main Navigation -->
  <nav class="flex-1 px-3 py-4 space-y-1" [class.px-2]="isCollapsed()">
    @if (!isCollapsed()) {
      <div
        class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3 px-2"
      >
        Main Menu
      </div>
    }

    <a
      *ngFor="let item of mainNavItems"
      [routerLink]="item.route"
      routerLinkActive="bg-gradient-to-r from-sky-500 to-indigo-600 text-white shadow-lg scale-105"
      [routerLinkActiveOptions]="{ exact: false }"
      [title]="isCollapsed() ? item.label : ''"
      class="group flex items-center justify-between px-3 py-3 rounded-lg hover:bg-gradient-to-r hover:from-sky-50 hover:to-indigo-50 hover:text-sky-600 transition-all duration-200 text-gray-700 font-medium cursor-pointer relative overflow-hidden"
      [ngClass]="isCollapsed() ? 'px-2.5 justify-center' : ''"
    >
      <span
        class="flex items-center gap-3 relative z-10"
        [ngClass]="isCollapsed() ? 'flex-col' : ''"
      >
        <span
          [innerHTML]="getSafeIcon(item.icon)"
          class="w-6 h-6 group-hover:scale-110 group-hover:rotate-3 transition-all duration-200 group-hover:text-sky-600 flex-shrink-0"
          [class]="getIconColorClass(item)"
        ></span>
        @if (!isCollapsed()) {
          <span
            class="group-hover:translate-x-1 transition-transform duration-200"
            >{{ item.label }}</span
          >
        }
      </span>

      <!-- Badge -->
      @if (item.badge && !isCollapsed()) {
        <span
          class="relative z-10 bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs font-bold rounded-full min-w-[24px] h-6 px-2 flex items-center justify-center shadow-lg animate-pulse"
        >
          {{ item.badge }}
        </span>
      }

      <!-- New Label -->
      @if (item.isNew && !isCollapsed()) {
        <span
          class="relative z-10 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-md"
        >
          NEW
        </span>
      }

      <!-- Arrow on active -->
      <svg
        routerLinkActive="opacity-100"
        class="w-4 h-4 md:w-5 md:h-5 opacity-0 absolute right-3 md:right-4 transition-opacity duration-200 flex-shrink-0"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        [ngClass]="isCollapsed() ? 'hidden' : ''"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"
        ></path>
      </svg>
    </a>
  </nav>

  <!-- Account Section -->
  <nav
    class="px-3 py-3 space-y-1 border-t border-gray-100 bg-gradient-to-br from-purple-50 to-pink-50"
    [class.px-2]="isCollapsed()"
  >
    @if (!isCollapsed()) {
      <div
        class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 px-2"
      >
        Your Account
      </div>
    }

    <a
      *ngFor="let item of secondaryNavItems"
      [routerLink]="item.route"
      routerLinkActive="bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg scale-105"
      [routerLinkActiveOptions]="{ exact: false }"
      [title]="isCollapsed() ? item.label : ''"
      class="group flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-white/80 hover:text-purple-600 transition-all duration-200 text-gray-700 font-medium cursor-pointer relative overflow-hidden"
      [ngClass]="isCollapsed() ? 'px-2.5 justify-center' : ''"
    >
      <span
        [innerHTML]="getSafeIcon(item.icon)"
        class="w-6 h-6 relative z-10 group-hover:scale-110 group-hover:rotate-3 transition-all duration-200 group-hover:text-purple-600 flex-shrink-0"
      ></span>
      @if (!isCollapsed()) {
        <span
          class="relative z-10 group-hover:translate-x-1 transition-transform duration-200"
          >{{ item.label }}</span
        >
      }
    </a>
  </nav>

  <!-- User Profile Section -->
  <div
    class="p-3 border-t border-gray-100"
    [class.flex]="isCollapsed()"
    [class.justify-center]="isCollapsed()"
  >
    <a
      routerLink="/profile"
      [title]="isCollapsed() ? 'Your Account' : ''"
      class="flex items-center gap-2 sm:gap-3 px-3 py-2.5 rounded-lg hover:bg-gradient-to-r hover:from-gray-50 hover:to-blue-50 hover:text-sky-500 transition-all cursor-pointer group"
      [ngClass]="isCollapsed() ? 'flex-col' : ''"
    >
      <div
        class="w-11 h-11 bg-gradient-to-br from-sky-400 via-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold shadow-lg ring-4 ring-white group-hover:ring-sky-100 transition-all flex-shrink-0"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
          ></path>
        </svg>
      </div>
      @if (!isCollapsed()) {
        <div class="flex-1 min-w-0">
          <p class="text-gray-900 font-bold text-sm truncate">Your Account</p>
          <p class="text-gray-500 text-xs truncate">Manage profile</p>
        </div>
        <svg
          class="w-5 h-5 text-gray-400 group-hover:text-sky-600 group-hover:translate-x-1 transition-all"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          ></path>
        </svg>
      }
    </a>
  </div>

  <!-- Quick Stats Footer -->
  <div
    class="p-3 bg-gradient-to-br from-sky-50 via-blue-50 to-indigo-50 border-t border-gray-100"
    [class.hidden]="isCollapsed()"
  >
    <div class="bg-white rounded-lg p-3 shadow-md">
      <div class="flex items-center justify-between mb-1.5">
        <span class="text-xs font-semibold text-gray-500">Weekly Goal</span>
        <span class="text-xs font-bold text-sky-600">75%</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
        <div
          class="bg-gradient-to-r from-sky-500 to-indigo-600 h-full rounded-full transition-all duration-500 shadow-sm"
          style="width: 75%"
        ></div>
      </div>
      <p class="text-xs text-gray-600 mt-1.5 text-center">
        3 of 4 workouts completed
      </p>
    </div>
  </div>
</aside>